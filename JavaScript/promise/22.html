<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Promise.resolve缓存后台数据</title>
</head>

<body>
  <script src="js/22.js"></script>
  <script>
    /*     // function hd() {}
    // hd.site = "houdunren.com";
    // console.dir(hd);
    Promise.hd = function (value) {
      return new Promise(resolve => {
        resolve(value);
      });
    };
    Promise.hd("后盾人").then(value => {
      console.log(value);
    });

    function query(name) {
      const cache = query.cache || (query.cache = new Map());
      if (cache.has(name)) {
        console.log("走缓存了");
        return Promise.resolve(cache.get(name));
      }
      return ajax(`http://localhost/php/user.php?name=${name}`).then(
        user => {
          cache.set(name, user);
          console.log("没走缓存");
          return user;
        }
      );
    }
    // query("后盾人").then(user => {
    //   console.log(user);
    // });
    // query("后盾人").then(user => {
    //   console.log(user);
    // });
    // setTimeout(() => {
    //   query("后盾人").then(user => {
    //     console.log(user);
    //   });
    // }, 1000);
    // setTimeout(() => {
    //   query("后盾人").then(user => {
    //     console.log(user);
    //   });
    // }, 1000);
    // console.log(Promise.resolve("后盾人"));
    // Promise.resolve("后盾人").then(value => {
    //   console.log(value);
    // }); */


    /* yznaisy */
    // console.log(Promise.resolve("houdunren")); //fulfilled
    // Promise.resolve("后盾人").then(value => {
    //   console.log(value) //后盾人
    // });

    function query(name) {
      const cache = query.cache || (query.cache = new Map());
      if (cache.has(name)) {
        console.log("缓存");
        return Promise.resolve(cache.get(name)) //Promise.resolve只是一个简写的方法
        // return new Promise((resolve => {
        //   return resolve(cache.get(name))
        // }))
      }
      return ajax(`http://localhost/php/user.php?name=${name}`).then(user => {
        cache.set(name, user);
        console.log("没走缓存");
        return user;
      })
    }
    query("后盾人").then(user => console.log(user))
    setTimeout(() => {
      query("后盾人").then(user => console.log(user))
    }, 1000)
    Promise.hd = function (name) {
      return new Promise((resolve => {
        resolve(name)
      }))
    }
    Promise.hd("houdunren").then(value => {
      console.log(value);
    })
    // console.log(Promise.hd("123"));   fulfilled

  </script>
</body>


</html>
